<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoaGame 1Min</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #333;
            margin: 0;
            padding: 0;
            color: #fff;
        }
        h1, h2 {
            color: #007bff;
            text-align: center;
            margin-top: 20px;
        }
        .card {
            max-width: 90%;
            margin: 20px auto;
            padding: 20px;
            border-radius: 8px;
            background-color: #444;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        #dataTable {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: #555;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #666;
        }
        th {
            background-color: #007bff;
            color: black;
            font-weight: bold;
        }
        td {
            background-color: #666;
        }
        tr:nth-child(even) td {
            background-color: #777;
        }
        tr:hover td {
            background-color: #888;
        }
        .win {
            color: #4CAF50;
            font-weight: bold;
        }
        .loss {
            color: #f44336;
            font-weight: bold;
        }
        .pending {
            color: #FFC107;
            font-weight: bold;
        }
        #predictionChart {
            width: 100%;
            height: 250px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background-color: #555;
        }
        #timeRemaining {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
        }
        #predictedNumber, #predictedPremium {
            font-size: 18px;
            text-align: center;
            margin: 10px 0;
        }
        .timer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }
        .timer-display {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
            color: #007bff;
        }
        .loading {
            color: #FFC107;
            text-align: center;
        }
        .error {
            color: #f44336;
            text-align: center;
        }
        @media (max-width: 768px) {
            .card {
                padding: 15px;
            }
            th, td {
                padding: 8px;
                font-size: 14px;
            }
            #timeRemaining {
                font-size: 20px;
            }
            #predictedNumber, #predictedPremium {
                font-size: 16px;
            }
            #predictionChart {
                height: 200px;
            }
            .timer-display {
                font-size: 28px;
            }
        }
        @media (max-width: 480px) {
            th, td {
                font-size: 12px;
            }
            #timeRemaining {
                font-size: 18px;
            }
            #predictedNumber, #predictedPremium {
                font-size: 14px;
            }
            #predictionChart {
                height: 180px;
            }
            .timer-display {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <h1>LICUIS ULTRA</h1>
    <div class="card">
        <h2>Live Prediction</h2>
        <p id="predictedNumber" class="loading">Prediction: Loading...</p>
        <p id="predictedPremium" class="loading">Premium: Loading...</p>
    </div>
    <div class="card">
        <h2>Timer</h2>
        <div class="timer-container">
            <div class="timer-display" id="timeRemaining">00:00:00</div>
        </div>
    </div>
    <div class="card">
        <h2>Latest Data</h2>
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Issue Number</th>
                    <th>Number</th>
                    <th>Premium</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated by JavaScript -->
            </tbody>
        </table>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tableBody = document.querySelector('#dataTable tbody');
            const predictedNumberElement = document.getElementById('predictedNumber');
            const predictedPremiumElement = document.getElementById('predictedPremium');
            const timerElement = document.getElementById('timeRemaining');
            
            let currentPrediction = null;
            let timerInterval;
            let lastIssueNumber = null;
            let isFirstLoad = true;

            // Add error handling for fetch requests
            const fetchWithTimeout = (url, options = {}, timeout = 5000) => {
                return Promise.race([
                    fetch(url, options),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Request timeout')), timeout)
                    )
                ]);
            };

            const fetchNoAverageEmerdList = () => {
                const timestamp = Date.now();
                const url = `https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json?ts=${timestamp}&pageSize=50&pageNo=1&typeId=1&language=0`;

                return fetchWithTimeout(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .catch(error => {
                        console.error('Error fetching history data:', error);
                        throw error;
                    });
            };

            const fetchGameIssue = () => {
                const requestData = {
                    typeId: 1,
                    language: 0,
                    timestamp: Math.floor(Date.now() / 1000)
                };

                return fetchWithTimeout('https://api.bdg88zf.com/api/webapi/GetGameIssue', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json;charset=UTF-8',
                        'Accept': 'application/json, text/plain, */*'
                    },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .catch(error => {
                    console.error('Error fetching game issue:', error);
                    throw error;
                });
            };

            const categorizeNumber = (number) => {
                if (number >= 0 && number <= 4) return 'Small';
                if (number >= 5 && number <= 9) return 'Big';
                return 'Unknown';
            };

            const generateRandomPrediction = () => {
                const randomNumber = Math.floor(Math.random() * 10);
                const randomCategory = categorizeNumber(randomNumber);
                return { number: randomNumber, category: randomCategory };
            };

            const updateDataAndPrediction = () => {
                fetchNoAverageEmerdList()
                    .then(data => {
                        if (!data || !data.data || !data.data.list) {
                            console.error('API response is missing expected data structure:', data);
                            predictedNumberElement.textContent = 'Prediction: Error loading data';
                            predictedNumberElement.className = 'error';
                            predictedPremiumElement.textContent = 'Premium: Error loading data';
                            predictedPremiumElement.className = 'error';
                            return;
                        }
                        
                        const list = data.data.list.slice(0, 10);
                        tableBody.innerHTML = '';

                        list.forEach(item => {
                            const numberCategory = categorizeNumber(Number(item.number));
                            const row = document.createElement('tr');
                            const premiumDisplay = item.premium !== undefined ? item.premium : 'N/A';
                            const issueNumberDisplay = item.issueNumber || 'N/A';

                            row.innerHTML = `
                                <td>${issueNumberDisplay}</td>
                                <td>${item.number} (${numberCategory})</td>
                                <td>${premiumDisplay}</td>
                            `;
                            tableBody.appendChild(row);
                        });

                        if (list.length === 0) {
                            predictedNumberElement.textContent = 'Prediction: No data available';
                            predictedPremiumElement.textContent = 'Premium: No data available';
                            return;
                        }

                        const latestIssue = list[0].issueNumber;
                        const latestActual = Number(list[0].number);
                        const actualCategory = categorizeNumber(latestActual);

                        // Check if we have a new issue or if this is the first load
                        if (lastIssueNumber !== latestIssue || isFirstLoad) {
                            // Generate a new prediction for the current issue
                            currentPrediction = generateRandomPrediction();
                            currentPrediction.issueNumber = latestIssue;
                            
                            lastIssueNumber = latestIssue;
                            isFirstLoad = false;
                        }

                        predictedNumberElement.textContent = `Prediction: ${currentPrediction.number} (${currentPrediction.category})`;
                        predictedNumberElement.className = '';
                        predictedPremiumElement.textContent = `Premium: ${currentPrediction.number}`;
                        predictedPremiumElement.className = '';
                    })
                    .catch(error => {
                        console.error('Error updating data and prediction:', error);
                        predictedNumberElement.textContent = 'Prediction: Connection error';
                        predictedNumberElement.className = 'error';
                        predictedPremiumElement.textContent = 'Premium: Connection error';
                        predictedPremiumElement.className = 'error';
                    });
            };

            // Update period and timer
            function updatePeriodAndTimer() {
                const now = new Date();
                const remainingSeconds = 60 - now.getUTCSeconds();
                const remainingMilliseconds = remainingSeconds * 1000 - (now.getUTCMilliseconds());
                
                // Format timer display
                const seconds = String(remainingSeconds).padStart(2, '0');
                timerElement.textContent = `00:00:${seconds}`;
                
                // Auto-refresh when period ends
                if (remainingMilliseconds <= 1000) {
                    setTimeout(() => {
                        updateDataAndPrediction();
                    }, 1000);
                }
            }

            const startTimer = () => {
                // Clear any existing timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // Start the timer with 1-second intervals
                timerInterval = setInterval(updatePeriodAndTimer, 1000);
            };

            // Initialize data and start the timer
            updateDataAndPrediction();
            startTimer();
        });
    </script>
</body>
</html>
